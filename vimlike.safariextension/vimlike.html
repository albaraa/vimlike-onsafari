<!DOCTYPE HTML>
<script>
  safari.application.addEventListener('message',function(eve){
    var data = eve.message;
    var mytab = safari.application.activeBrowserWindow.activeTab;
    var pos = 0;
    if( data == 'previous' ){
      pos = -1;
    }else if( data == 'next'){
      pos = 1;
    }else if( data == 'close' ){
      mytab.close();
      return;
    }
    var tabs = safari.application.activeBrowserWindow.tabs;
    var len = tabs.length;

    //circle tabs
    if( tabs[len-1] == mytab && pos == 1){
      tabs[0].activate();
      return;
    }
    if( tabs[0] == mytab && pos == -1 ){
      tabs[len-1].activate();
      return;
    }

    //activate
    while( len-- ){
      if( tabs[len] == mytab && typeof tabs[len+pos] != 'undefined'){
        tabs[len+pos].activate();
        break;
      }
    }

  },false);

/*safari.extension.settings.addEventListener('change',function(eve){
    if( eve.key == 'hintText' ){
      safari.application.activeBrowserWindow.activeTab.page.dispatchMessage("hintMessage", eve.newValue );
    }
},false );

//init
var hintText = safari.extension.settings.getItem('hintText');
safari.application.activeBrowserWindow.activeTab.page.dispatchMessage("hintMessage", hintText);*/
</script>
